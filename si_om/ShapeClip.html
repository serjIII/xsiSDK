<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- saved from url=(0024)http://docs.autodesk.com -->
<html>
   <head>
<link href="../style/prettify.css" type="text/css" rel="stylesheet" />
<script type="text/javascript" src="../scripts/prettify.js"></script><script src="../scripts/lib/jquery-1.9.1.min.js" type="text/javascript"></script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><script type="text/javascript" src="../scripts/utils/adsk.redirect.js"></script>
      <title>ShapeClip</title>
   
</head>
   <body height="100%"><div class="body_content" id="body-content"><style>
/*  These settings override ones in the default stylesheets
	used by the merged files that cause problems in combination
	with the standard HTML help styles and page templates. */

div, div.example, div.tip {
	 margin:0;
}

td.example {
	background: inherit;
}

/* This fixes a problem with nested pre blocks on an example page */
pre pre {
	display:block;
	padding:0;
	border-style:none;
}
</style><link rel="stylesheet" href="si_om/css/en.css" type="text/css" /><script>$(document).ready(function() { yepnope.injectJs("./si_om/lib/utils.js"); });</script><script>$(document).ready(function() { yepnope.injectJs("./scripts/ac_common.js"); });</script><script type="text/javascript">var reflinkid = "si_cpp"; var reflinkdata = new Array(); function closeRefLinkDiv() { }; $(document).on('click', function() { closeRefLinkDiv(); } );</script><script>$(document).ready(function() { yepnope.injectJs("./scripts/multireflink.js"); });</script><script>$(document).ready(function () { prettyPrint(); } );</script><script>$("div#WidgetFloaterPanels,link[href*='microsofttranslator.com'],script[src*='microsofttranslator.com'],script[src*='bing.com']").remove();</script><script type='text/javascript'>$("div#navigation,div#breadcrumbs,div#banner").attr("translate","no"); var mtLocation = ((location && location.href && location.href.indexOf('https') == 0)?'https://ssl.microsofttranslator.com':'http://www.microsofttranslator.com')+'/ajax/v3/WidgetV3.ashx?siteData=y5CYlxTRD0znCzRLDwX0Wy7-g1EdC1XA4dSC-Y1LtaeScyli8_Ps5jPKqTr4xKxMI0OOUfkDplvX3uxN0JnPclebSYW8_J1HBzf4VLQEzQ8M4PsYXF_cMyp1Oumaetky&category=5297189e-446b-459e-ae1d-9d0360400781_tech&ctf=True&ui=true&settings=Manual&from=en&hidelanguages='; yepnope.injectJs(mtLocation, function() {}, { charset:'utf-8', type:'text/javascript' } );</script><script type="text/javascript">
 </script><!-- begin MT -->
            
            <div id='MicrosoftTranslatorWidget' class='Dark' style='position:absolute;right:20px;top:5px;z-index:100;color:white;background-color:#555555;height:58px;overflow:hidden'></div><div id="reflinkdiv" style="display:none; font-family: 'RobotoRegular', Arial, Tahoma, sans-serif; visibility:hidden; position:absolute; z-index:40001; padding:5px; border-style:solid; border-width:1px; border-color:#666666; background-color:#dfdfdf; overflow:visible"></div>
      <div>
         <div class="head">
            <h1>ShapeClip</h1>
         </div>

<h2 class="pagehead">ShapeClip</h2>

<p><a href="#!/url=./si_om/_hier.html#oh_ShapeClip">Object Hierarchy</a> | Related C++ Class: <a href="#!/url=./si_cpp/classXSI_1_1ShapeClip.html">ShapeClip</a></p>

<h3>Inheritance<h3>
<p class="level1"><a href="#!/url=./si_om/SIObject.html">SIObject</a></p>
<p class="level2"><a href="#!/url=./si_om/ProjectItem.html">ProjectItem</a></p>
<p class="level3"><a href="#!/url=./si_om/Clip.html">Clip</a></p>
<p class="level4">ShapeClip</p>

<h3>Introduced</h3>
<div><p>v1.5</p></div>

<h3>Description</h3>
<div><p> A ShapeClip object is an instance of a shape key (source) at a particular position along a shape track 
in the animation mixer. You can create shape clips using the <a href="#!/url=./si_om/Geometry.SaveShapeKey.html">Geometry.SaveShapeKey</a>
method. To enumerate existing shape clips you must pass the full string path of the shape  
track's ClipList to the <a href="#!/url=./si_cmds/EnumElements.html">EnumElements</a> command which returns a collection of
ShapeClip objects.<br /><br />
You can create multiple clips of the same source (using the <a href="#!/url=./si_cmds/AddClip.html">AddClip</a> command), 
thereby returning to the same shape several times in the same animation, or rearrange the order 
of the shape clips on the tracks to change the shape animation completely. <br /><br /> 
The ShapeClip object allows you to access the shape animation stored in clusters by using the 
<a href="#!/url=./si_om/Clip.MappedItems.html">Clip.MappedItems</a> method. Each <a href="#!/url=./si_om/MappedItem.html">MappedItem</a> object returns the 
<a href="#!/url=./si_om/ShapeKey.html">ShapeKey</a> object (a specialized kind of <a href="#!/url=./si_om/ClusterProperty.html">ClusterProperty</a>) from
the <a href="#!/url=./si_om/MappedItem.Source2.html">MappedItem.Source2</a> method. <a href="#!/url=./si_om/ShapeKey.html">ShapeKey</a>s contain shape 
animation data and you can use the ShapeKey's base property <a href="#!/url=./si_om/SIObject.Parent.html">SIObject.Parent</a> to
get the shape-animated <a href="#!/url=./si_om/Cluster.html">Cluster</a> object.<br /><br /> 
When you save a shape key in local reference mode (siShapeLocalReferenceMode) only the deltas
to the point's local referential are stored. If you need to get the absolute position for 
each point in the  shape you will need the local referential for the point and the original position of 
the point before the shape key was applied. <br /><br /> 
In order to get the local referential (<a href="#!/url=./si_om/Geometry0D.LocalReferenceFrame.html">Geometry0D.LocalReferenceFrame</a>) and the 
original position for each point you will need to mute the shape combiner and all other operators above 
it using the <a href="#!/url=./si_cmds/DeactivateAbove.html">DeactivateAbove</a> command. 
</p></div>

<h3>Methods</h3>
<div><p><table>
	<tr>

		<td class="members"><a href="#!/url=./si_om/ProjectItem.AddCustomOp.html">AddCustomOp</a>		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.AddICEAttribute.html">AddICEAttribute</a>		</td>		<td class="members"><a href="#!/url=./si_om/Clip.AddProperty.html">AddProperty</a>		</td>		<td class="members"><a href="#!/url=./si_om/Clip.AddProperty2.html">AddProperty2</a>		</td>	</tr>

	<tr>

		<td class="members"><a href="#!/url=./si_om/ProjectItem.AddScriptedOp.html">AddScriptedOp</a>		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.AddScriptedOpFromFile.html">AddScriptedOpFromFile</a>		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.AnimatedParameters2.html">AnimatedParameters2</a>		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.BelongsTo.html">BelongsTo</a> <img src="images/operator.gif" alt="operator" />		</td>	</tr>

	<tr>

		<td class="members"><a href="#!/url=./si_om/ProjectItem.EvaluateAt.html">EvaluateAt</a>		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.GetICEAttributeFromName.html">GetICEAttributeFromName</a>		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.IsA.html">IsA</a>		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.IsAnimated2.html">IsAnimated2</a>		</td>	</tr>

	<tr>

		<td class="members"><a href="#!/url=./si_om/SIObject.IsClassOf.html">IsClassOf</a> <img src="images/operator.gif" alt="operator" />		</td>		<td class="members"><a href="#!/url=./si_om/SIObject.IsEqualTo.html">IsEqualTo</a> <img src="images/operator.gif" alt="operator" />		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.IsKindOf.html">IsKindOf</a>		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.IsLocked.html">IsLocked</a> <img src="images/operator.gif" alt="operator" />		</td>	</tr>

	<tr>

		<td class="members"><a href="#!/url=./si_om/ProjectItem.IsSelected.html">IsSelected</a> <img src="images/operator.gif" alt="operator" />		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.LockOwners.html">LockOwners</a>		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.RemoveICEAttribute.html">RemoveICEAttribute</a>		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.SetAsSelected.html">SetAsSelected</a> <img src="images/operator.gif" alt="operator" />		</td>	</tr>

	<tr>

		<td class="members"><a href="#!/url=./si_om/ProjectItem.SetCapabilityFlag.html">SetCapabilityFlag</a> <img src="images/operator.gif" alt="operator" />		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.SetLock.html">SetLock</a>		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.TaggedParameters.html">TaggedParameters</a>		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.UnSetLock.html">UnSetLock</a>		</td>	</tr>

</table>
</p></div>

<h3>Properties</h3>
<div><p><table>
	<tr>

		<td class="members"><a href="#!/url=./si_om/SIObject.Application.html">Application</a>		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.BranchFlag.html">BranchFlag</a> <img src="images/operator.gif" alt="operator" />		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.Capabilities.html">Capabilities</a> <img src="images/operator.gif" alt="operator" />		</td>		<td class="members"><a href="#!/url=./si_om/SIObject.Categories.html">Categories</a>		</td>	</tr>

	<tr>

		<td class="members"><a href="#!/url=./si_om/Clip.Effect.html">Effect</a>		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.EvaluationID.html">EvaluationID</a>		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.Families.html">Families</a> <img src="images/operator.gif" alt="operator" />		</td>		<td class="members"><a href="#!/url=./si_om/SIObject.FullName.html">FullName</a> <img src="images/operator.gif" alt="operator" />		</td>	</tr>

	<tr>

		<td class="members"><a href="#!/url=./si_om/SIObject.Help.html">Help</a>		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.HierarchicalEvaluationID.html">HierarchicalEvaluationID</a>		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.ICEAttributes.html">ICEAttributes</a>		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.LockLevel.html">LockLevel</a> <img src="images/operator.gif" alt="operator" />		</td>	</tr>

	<tr>

		<td class="members"><a href="#!/url=./si_om/ProjectItem.LockMasters.html">LockMasters</a> <img src="images/operator.gif" alt="operator" />		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.LockType.html">LockType</a> <img src="images/operator.gif" alt="operator" />		</td>		<td class="members"><a href="#!/url=./si_om/Clip.MappedItems.html">MappedItems</a>		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.Model.html">Model</a>		</td>	</tr>

	<tr>

		<td class="members"><a href="#!/url=./si_om/SIObject.Name.html">Name</a> <img src="images/operator.gif" alt="operator" />		</td>		<td class="members"><a href="#!/url=./si_om/SIObject.NestedObjects.html">NestedObjects</a>		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.ObjectID.html">ObjectID</a>		</td>		<td class="members"><a href="#!/url=./si_om/SIObject.Origin.html">Origin</a>		</td>	</tr>

	<tr>

		<td class="members"><a href="#!/url=./si_om/SIObject.OriginPath.html">OriginPath</a>		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.Owners.html">Owners</a>		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.PPGLayout.html">PPGLayout</a> <img src="images/operator.gif" alt="operator" />		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.Parameters.html">Parameters</a> <img src="images/operator.gif" alt="operator" />		</td>	</tr>

	<tr>

		<td class="members"><a href="#!/url=./si_om/SIObject.Parent.html">Parent</a>		</td>		<td class="members"><a href="#!/url=./si_om/ProjectItem.Parent3DObject.html">Parent3DObject</a>		</td>		<td class="members"><a href="#!/url=./si_om/Clip.Properties.html">Properties</a>		</td>		<td class="members"><a href="#!/url=./si_om/Clip.Relations.html">Relations</a>		</td>	</tr>

	<tr>

		<td class="members"><a href="#!/url=./si_om/ProjectItem.Selected.html">Selected</a> <img src="images/operator.gif" alt="operator" />		</td>		<td class="members"><a href="#!/url=./si_om/Clip.Source.html">Source</a>		</td>		<td class="members"><a href="#!/url=./si_om/Clip.TimeControl.html">TimeControl</a>		</td>		<td class="members"><a href="#!/url=./si_om/SIObject.Type.html">Type</a> <img src="images/operator.gif" alt="operator" />		</td>	</tr>

</table>
</p></div>

<h3>Examples</h3>
<div><p><h4>1. VBScript Example</h4><div class="example"><table>
<tr>
<td class="example"><pre class="vbscript">'
' The following example illustrates how to access the position
' information stored in a shape key. Adding a shape key using  
' local reference mode will store the positions as deltas to 
' the local referential of each point. To calculate the 
' absolute position for each point you need the local
' referential for the point and the original position before
' the shape was applied. 
'
' Create the scene with an object with a shape clip	
NewScene , false
set root = ActiveSceneRoot
set c1 = root.AddGeometry( "Cube", "MeshSurface" )
set c2 = Duplicate( c1, , 2, 1, 1, 0, 0, 1, 0, 1 )(0)
Translate c2, 10, 0, -2, siRelative, siView, siObj, siXYZ
Translate c2 &amp; ".pnt[2,3,6,LAST]", -6, -4, 4, siRelative, siView, siObj, siXYZ
' Add a shapeclip where the position data is stored as deltas to 
' the point's local referential. You can also store the shape in
' absolute mode in which case the cluster property contains 
' for the shape the actual point data or you can store it in 
' object mode in which case deltas are stored in the object
' referential (i.e. the pose of the object). 
set key = SelectShapeKey( c1, c2, siShapeLocalReferenceMode )
dim mix
if root.HasMixer() then
	set mix = root.Mixer
else
	set mix = root.AddMixer()
end if
set shapetrack = AddTrack( root, mix, 1 )
AddClip root, key, , shapetrack, 1, , , , False
'
' Get the shapeclip 
' 
dim clip
for each c in mix.Clips
	if c.Type = siClipShapeType then
		set clip = c
	end if
next
' We need to mute the shape combiner and all the operators above it 
' inorder to get the local reference frame and position of each
' point before the shape animation was applied to the geometry. 
' (This gives the position values before the shape that was stored 
' and does not include the result of deformations applied afterwards.) 
set geom = Nothing
set oMatrix33 = XSIMath.CreateMatrix3
set oDelta = XSIMath.CreateVector3
set oXAxis = XSIMath.CreateVector3
set oYAxis = XSIMath.CreateVector3
set oZAxis = XSIMath.CreateVector3
for idx=0 to clip.MappedItems.Count-1
	set mi = clip.MappedItems(idx)
	LogMessage TypeName(mi)
	LogMessage TypeName(mi.Source2)
	' Get the cluster property/shape key stored in the shapeclip
	set clsprop = mi.Source2
	' Since the geometry for each mappeditem will be
	' the same we'll only need to get it once.	
	if TypeName(geom) = "Nothing" then
		' Get the cluster, primitive and geometry from the 
		' cluster property
		set cls = clsprop.Parent
		set geom = cls.Parent
		set prim = geom.Parent
		' Deactivate all operators above and including the shape combiner
		DeactivateAbove prim.FullName &amp; ".clustershapecombiner", True
		' Get the position array from the geometry
		aPosition = geom.Points.PositionArray
		' Get the old Geometry0D object to access 
		' the local reference frame for each point
		set geomv1 = geom.Parent.Obj
		set o0DGeometry = geomv1.Geometry0D 
	end if
	' Assume that the number of cluster property elements
	' matches the geometry and that they are same order i.e. 
	' point0 == clusterelement0
	' Get the delta position array from the clusterproperty
	aDelta = clsprop.Elements.Array
	' Figure out the absolute position value using the deltas,
	' the original point position and the local referential 
	' of each point
	for i=LBound( aDelta, 2 ) to UBound( aDelta, 2 )
		' Set a vector3 with the delta for the position
		oDelta.Set aDelta( 0, i ), aDelta( 1, i ), aDelta( 2, i )
		' Get the local reference frame for the point
		o0DGeometry.LocalReferenceFrame i, _
			oXAxis, oXAxisValid, _
			oYAxis, oYAxisValid, _
			oZAxis, oZAxisValid
		' Get the transformation matrix to go from point
		' local reference frame to object referential
		oMatrix33.Set _
				oXAxis.X , oXAxis.Y, oXAxis.Z, _
				oYAxis.X , oYAxis.Y, oYAxis.Z, _
				oZAxis.X , oZAxis.Y, oZAxis.Z 
		oDelta.MulByMatrix3 oDelta, oMatrix33 
		' Set a vector3 with the point position		
		set oPosition = XSIMath.CreateVector3
		oPosition.Set _
			aPosition( 0, i ), _
			aPosition( 1, i ), _
			aPosition( 2, i )
		' Compute the absolute position by adding the delta
		oPosition.AddInPlace oDelta
		' Log the absolute position values for the point
		LogMessage oPosition.X &amp; "," &amp; oPosition.Y &amp; "," &amp; oPosition.Z		
	next
next
' Reactivate shapecombiner and all operators above it 
if TypeName(prim) &lt;&gt; "Nothing" then
	DeactivateAbove prim.FullName &amp; ".clustershapecombiner", False
end if	
' Enumerate the shapeclips under the mixer shape track.
for each t in ActiveSceneRoot.Mixer.Tracks
	if t.Type = siTrackShapeType then
		set shapetrack = t
		exit for
	end if
next
for each shapeclip in shapetrack.Clips
	LogMessage shapeclip
next
'Expected results:
'INFO : MappedItem
'INFO : ShapeKey
'INFO : -4,-4,-4
'INFO : 4,-4,-4
'INFO : -10,1.33226762955019E-15,-1.33226762955019E-15
'INFO : -2,1.33226762955019E-15,-1.33226762955019E-15
'INFO : -4,-4,4
'INFO : 4,-4,4
'INFO : -10,8.88178419700125E-16,8
'INFO : -2,8.88178419700125E-16,8
'INFO : Mixer.Mixer_Shape_Track.cube1_ShapeKey_Clip</pre></td></tr>
</table>
</div><h4>2. JScript Example</h4><div class="example"><table>
<tr>
<td class="example"><pre class="jscript">/*
	This Shape Animation example demonstrates how to use GetDrivingActions() 
	to get at the ShapeClips which animate an object. It also demonstrates 
	how to access the fcurves on each clip
*/
// Create a little sample scene with a simple animated sphere
NewScene( null, false );
// Make sure we are in Mixed Weight Mode
SetUserPref( "ShapeInstancingMode", 1 );
var oSphere = ActiveSceneRoot.AddGeometry( "Sphere", "MeshSurface" );
SaveShapeKey( "sphere", null, null, 1, null, null, null, null, 
	siShapeLocalReferenceMode );
// Move a vertice and record that as the shape at frame 20
SelectGeometryComponents( "sphere.pnt[33]" );
Translate( null, 3, 0, 0, siRelative, siView, siObj, siXYZ );
SaveShapeKey( oSphere + ".pnt[33]", null, null, 20, null, null, null, null, 
	siShapeLocalReferenceMode );
// Move another point as shape for frame 30
SelectGeometryComponents( "sphere.pnt[1]" );
Translate( null, 0, 3, 0, siRelative, siView, siObj, siXYZ );
SaveShapeKey( oSphere + ".pnt[1]", null, null, 30, null, null, null, null, 
	siShapeLocalReferenceMode );
// Access the ShapeClips which have been created on the object
var oClips = GetDrivingActions( oSphere, false, null, false, false );
for ( var i=0; i&lt;oClips.Count; i++ ) {
	// Get the clip
	var oClip = oClips(i);
	// Access the animated parameter which controls the weight of the clip
	// in the mixer
	var oParam = Dictionary.GetObject( oClip + ".actionclip.weight" );
	var oFCurve = oParam.Source;
	// At frame 40 we will do an equal blend of all the shapes
	oFCurve.AddKey( 40, 1 );
	// Print out the keys	
	var oFCurveKeys = oFCurve.Keys;
	LogMessage( "FCurve on " + oClip );
	for ( var j=0; j&lt;oFCurveKeys.Count; j++ ) {
		var oFCurveKey = oFCurveKeys.Item( i );
		LogMessage( "    Time:" + oFCurveKey.Time + "-" + oFCurveKey.Value );
	}
}
// Expected result:
//INFO : FCurve on Mixer.Mixer_Shape_Track.Shape_ClusterClip.Mixer_Shape_Track3.ShapeKey2_Clip
//INFO :     Time:20-0
//INFO :     Time:20-0
//INFO :     Time:20-0
//INFO : FCurve on Mixer.Mixer_Shape_Track.Shape_ClusterClip.Mixer_Shape_Track2.ShapeKey1_Clip
//INFO :     Time:20-1
//INFO :     Time:20-1
//INFO :     Time:20-1
//INFO :     Time:20-1
//INFO : FCurve on Mixer.Mixer_Shape_Track.Shape_ClusterClip.Mixer_Shape_Track1.ShapeKey_Clip
//INFO :     Time:40-1
//INFO :     Time:40-1
//INFO :     Time:40-1</pre></td></tr>
</table>
</div></p></div>

<h3>See Also</h3>
<div><p><a href="#!/url=./si_om/Geometry.SaveShapeKey.html">Geometry.SaveShapeKey</a> <a href="#!/url=./si_cmds/GetDrivingActions.html">GetDrivingActions</a> <a href="#!/url=./si_cmds/EnumElements.html">EnumElements</a> <a href="#!/url=./si_om/Dictionary.GetObject.html">Dictionary.GetObject</a></p></div>

      <div class="footer-block"><a href="../html/ac.cmtdialog.htm" class="comments-anchor" target="_blank"><span class="comments-link">Please send us your comment about this page</span></a></div><br /></h3></h3></div>
   </div></body>
</html>
